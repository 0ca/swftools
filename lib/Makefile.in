top_builddir = ..
srcdir = @srcdir@
top_srcdir = @top_srcdir@
include ../Makefile.common

DEVICES = devices/file.$(O) devices/swf.$(O) devices/render.$(O)

all: librfxswf$(A) q.$(O) mem.$(O) os.$(O) gfxtools.$(O) gfxfont.$(O) art/libart$(A) png.$(O) mp3.$(O) wav.$(O) $(DEVICES)


lame_objects = @lame_objects@

h263_objects = h.263/dct.$(O) h.263/h263tables.$(O) h.263/swfvideo.$(O)
actioncompiler_objects = action/assembler.$(O) action/compile.$(O) action/lex.swf4.$(O) action/lex.swf5.$(O) action/libming.$(O) action/swf4compiler.tab.$(O) action/swf5compiler.tab.$(O) action/actioncompiler.$(O)
rfxswf_modules =  modules/swfbits.c modules/swfaction.c modules/swfdump.c modules/swfcgi.c modules/swfbutton.c modules/swftext.c modules/swffont.c modules/swftools.c modules/swfsound.c modules/swfshape.c modules/swfobject.c modules/swfdraw.c modules/swfrender.c h.263/swfvideo.c

bitio.$(O): bitio.c bitio.h
	$(C) bitio.c -o $@
drawer.$(O): drawer.c drawer.h
	$(C) drawer.c -o $@
q.$(O): q.c q.h $(top_builddir)/config.h
	$(C) q.c -o $@
mem.$(O): mem.c mem.h $(top_builddir)/config.h
	$(C) mem.c -o $@
png.$(O): png.c png.h $(top_builddir)/config.h
	$(C) png.c -o $@
mp3.$(O): mp3.c mp3.h $(top_builddir)/config.h
	$(C) mp3.c -o $@
wav.$(O): wav.c wav.h $(top_builddir)/config.h
	$(C) wav.c -o $@
os.$(O): os.c os.h $(top_builddir)/config.h
	$(C) -DSWFTOOLS_DATADIR=\"$(pkgdatadir)\" os.c -o $@
gfxtools.$(O): gfxtools.c gfxtools.h $(top_builddir)/config.h
	$(C) gfxtools.c -o $@
gfxfont.$(O): gfxfont.c gfxfont.h $(top_builddir)/config.h
	$(C) gfxfont.c -o $@

MD5.$(O): MD5.c MD5.h
	$(C) MD5.c -o $@
log.$(O): log.c log.h
	$(C) log.c -o $@
rfxswf.$(O): rfxswf.c rfxswf.h drawer.h bitio.h log.h MD5.h $(rfxswf_modules) $(top_builddir)/config.h
	$(C) rfxswf.c -o $@

$(lame_objects):
	cd lame;$(MAKE) all;cd ..
$(actioncompiler_objects):
	cd action;$(MAKE) all;cd ..

art/libart$(A):
	cd art; $(MAKE) libart$(A);cd ..

h.263/dct.$(O):  h.263/dct.c h.263/dct.h
	$(C) h.263/dct.c -o h.263/dct.$(O)
h.263/h263tables.$(O): h.263/h263tables.c h.263/h263tables.h
	$(C) h.263/h263tables.c -o h.263/h263tables.$(O)
h.263/swfvideo.$(O): h.263/swfvideo.c h.263/h263tables.h h.263/dct.h
	$(C) h.263/swfvideo.c -o h.263/swfvideo.$(O)

devices/swf.$(O):  devices/swf.c devices/swf.h
	$(C) devices/swf.c -o devices/swf.$(O)
devices/file.$(O):  devices/file.c devices/file.h
	$(C) devices/file.c -o devices/file.$(O)
devices/render.$(O):  devices/render.c devices/render.h
	$(C) devices/render.c -o devices/render.$(O)

librfxswf$(A): Makefile rfxswf.$(O) drawer.$(O) bitio.$(O) log.$(O) MD5.$(O) mem.$(O) $(lame_objects) $(h263_objects) $(actioncompiler_objects)
	$(AR) r librfxswf$(A) rfxswf.$(O) drawer.$(O) bitio.$(O) log.$(O) MD5.$(O) mem.$(O) $(lame_objects) $(h263_objects) $(actioncompiler_objects)
	$(RANLIB) librfxswf$(A)

install:
uninstall:

clean: 
	rm -f *.o *.obj *.lo *.a *.la gmon.out
	cd lame && $(MAKE) clean && cd .. || true
	cd action && $(MAKE) clean && cd ..
	cd python && $(MAKE) clean && cd ..
	cd art && $(MAKE) clean && cd ..

