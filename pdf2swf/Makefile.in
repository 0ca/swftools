top_builddir = ..
srcdir = @srcdir@
top_srcdir = @top_srcdir@
include ../Makefile.common

all: pdf2swf$(E)

fonts = n021003l.pfb n021023l.pfb n021004l.pfb n021024l.pfb n019003l.pfb n019023l.pfb n019004l.pfb n019024l.pfb n022003l.pfb n022023l.pfb n022004l.pfb n022024l.pfb s050000l.pfb d050000l.pfb n021003l.afm n021023l.afm n021004l.afm n021024l.afm n019003l.afm n019023l.afm n019004l.afm n019024l.afm n022003l.afm n022023l.afm n022004l.afm n022024l.afm s050000l.afm d050000l.afm

SWFOutputDev.$(O): swfoutput.h SWFOutputDev.cc
	$(CC) -Ixpdf -I../lib SWFOutputDev.cc -o $@
spline.$(O): spline.cc spline.h
	$(CC) -I../lib spline.cc -o $@
encodings.$(O): encodings.cc
	$(CC) -I../lib encodings.cc -o $@
pdf2swf.$(O): pdf2swf.cc SWFOutputDev.h
	$(CC) -I../lib pdf2swf.cc -o $@
swfoutput.$(O): swfoutput.cc swfoutput.h spline.h
	$(CC) -I../lib swfoutput.cc -o $@

pdf2swf$(A): Makefile SWFOutputDev.$(O) swfoutput.$(O) encodings.$(O) spline.$(O) ../lib/os.$(O) ../lib/gfxtools.$(O) ../lib/gfxfont.$(O)
	$(AR) r pdf2swf$(A) SWFOutputDev.$(O) swfoutput.$(O) encodings.$(O) spline.$(O) ../lib/os.$(O) ../lib/gfxtools.$(O) ../lib/gfxfont.$(O)
	$(RANLIB) pdf2swf$(A)

pdf2swf$(E): pdf2swf.$(O) pdf2swf$(A) xpdf/libpdf$(A) ../lib/librfxswf$(A) ../lib/art/libart$(A)
	$(LL) pdf2swf.$(O) pdf2swf$(A) ../lib/librfxswf$(A) ../lib/art/libart$(A) xpdf/libpdf$(A) $(LIBS) -o pdf2swf$(E) 
	$(STRIP) pdf2swf$(E)

pdf2swf.dll:  pdf2swf$(A)
	$(LL) -O -shared -o pdf2swf.dll pdf2swf.def \
		pdf2swf$(A) xpdf/libpdf$(A) ../lib/librfxswf$(A) ../lib/art/libart$(A) $(LIBS) \
		-Wl,-v,--output-def,pdf2swf.tmp.def,--out-implib,pdf2swf_dll.a 

xpdf/libpdf$(A): Makefile xpdf/gfile.cc xpdf/GfxState.cc xpdf/GlobalParams.cc
	cd xpdf;$(MAKE)

ttf2pt1/ttf2pt1$(A): Makefile ttf2pt1/ttf2pt1.c ttf2pt1/t1asm.c
	cd ttf2pt1;$(MAKE)

install:
	$(mkinstalldirs) $(bindir)
	$(mkinstalldirs) $(man1dir)
	@file=pdf2swf;$(INSTALL_BIN);$(INSTALL_MAN1)
	$(mkinstalldirs) $(pkgdatadir)/fonts
	@echo installing fonts in $(pkgdatadir)/fonts;for file in $(fonts);do $(INSTALL_DATA) fonts/$$file $(pkgdatadir)/fonts/$$file;done
	
uninstall:
	@file=pdf2swf;$(UNINSTALL_BIN);$(UNINSTALL_MAN1)
	@for file in $(fonts);do $(UNINSTALL_DATA) $(pkgdatadir)/fonts/$$file;done

clean: 
	rm -f *.o *.obj *.lo *.a *.lib *.la pdf2swf font2swf gmon.out
	@rm -f pdf2swf.exe font2swf.exe
	@rm -f pdf2swf$(E) font2swf.exe$(E)
	cd xpdf && $(MAKE) clean && cd ..

