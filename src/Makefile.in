top_builddir = ..
srcdir = @srcdir@
top_srcdir = @top_srcdir@
include ../Makefile.common

programs = wav2swf$(E) @PNG2SWF@ swfcombine$(E) swfstrings$(E) swfextract$(E) swfdump$(E) swfc$(E) @JPEG2SWF@ @GIF2SWF@ swfbbox$(E) font2swf$(E) @PDF2SWF@

all: $(programs)

wav2swf.$(O): wav2swf.c ../lib/wav.h
	$(C) wav2swf.c -o $@
png2swf.$(O): png2swf.c
	$(C) png2swf.c -o $@
pdf2swf.$(O): pdf2swf.c
	$(C) pdf2swf.c -o $@
gif2swf.$(O): gif2swf.c
	$(C) gif2swf.c -o $@
swfcombine.$(O): swfcombine.c
	$(C) swfcombine.c -o $@
swfdump.$(O): swfdump.c
	$(C) swfdump.c -o $@
swfextract.$(O): swfextract.c
	$(C) swfextract.c -o $@
swfstrings.$(O): swfstrings.c
	$(C) swfstrings.c -o $@
swfbbox.$(O): swfbbox.c
	$(C) swfbbox.c -o $@
swfedit.$(O): swfedit.c
	$(C) swfedit.c -o $@
swf2png.$(O): swf2png.c
	$(C) swf2png.c -o $@
jpeg2swf.$(O): jpeg2swf.c
	$(C) jpeg2swf.c -o $@
swfrender.$(O): swfrender.c
	$(C) swfrender.c -o $@
font2swf.$(O): font2swf.c
	$(C) font2swf.c -o $@
swfc.$(O): swfc.c parser.h ../lib/q.h
	$(C) swfc.c -o $@
parser.$(O): parser.yy.c parser.h ../lib/q.h
	$(C) parser.yy.c -o $@

../lib/librfxswf$(A): ../lib/modules/swfrender.c ../lib/modules/swfshape.c ../lib/modules/swfbits.c ../lib/rfxswf.c
	cd ../lib;$(MAKE) librfxswf$(A);cd -

# TODO: include the following rule only if lex is available
parser.yy.c: parser.lex
	flex -B -s -oparser.yy.c parser.lex

wav2swf$(E): wav2swf.$(O) ../lib/wav.$(O) ../lib/librfxswf$(A)
	$(L) wav2swf.$(O) ../lib/wav.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@
png2swf$(E): png2swf.$(O) ../lib/librfxswf$(A)
	$(L) png2swf.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@
gif2swf$(E): gif2swf.$(O) ../lib/librfxswf$(A)
	$(L) gif2swf.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@
swfcombine$(E): swfcombine.$(O) ../lib/librfxswf$(A)
	$(L) swfcombine.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@
swfdump$(E): swfdump.$(O) ../lib/librfxswf$(A)
	$(L) swfdump.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@
swfedit$(E): swfedit.$(O) ../lib/librfxswf$(A)
	$(L) swfedit.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@
swf2png$(E): swf2png.$(O) ../lib/librfxswf$(A) ../lib/png.$(O)
	$(L) swf2png.$(O) -o $@ ../lib/librfxswf$(A) ../lib/png.$(O) $(LIBS)
	$(STRIP) $@
swfextract$(E): swfextract.$(O) ../lib/librfxswf$(A)
	$(L) swfextract.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@
swfstrings$(E): swfstrings.$(O) ../lib/librfxswf$(A)
	$(L) swfstrings.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@
swfbbox$(E): swfbbox.$(O) ../lib/librfxswf$(A)
	$(L) swfbbox.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@
font2swf$(E): font2swf.$(O) ../lib/librfxswf$(A)
	$(L) font2swf.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@
jpeg2swf$(E): jpeg2swf.$(O) ../lib/librfxswf$(A)
	$(L) jpeg2swf.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@
swfrender$(E): swfrender.$(O) ../lib/librfxswf$(A) ../lib/png.$(O)
	$(L) swfrender.$(O) -o $@ ../lib/librfxswf$(A) ../lib/png.$(O) $(LIBS)
	$(STRIP) $@
pdf2swf$(E): pdf2swf.$(O) ../lib/librfxswf$(A) ../lib/libpdf$(A) ../lib/devices/ops.$(O) ../lib/devices/arts.$(O) ../lib/devices/swf.$(O) ../lib/devices/render.$(O)
	$(LL) pdf2swf.$(O) -o $@ ../lib/librfxswf$(A) ../lib/libpdf$(A) ../lib/gfxtools.$(O) ../lib/gfxfont.$(O) ../lib/os.$(O) ../lib/devices/swf.$(O) ../lib/devices/arts.$(O) ../lib/devices/ops.$(O) ../lib/devices/record.$(O) ../lib/devices/render.$(O) ../lib/art/libart$(A) $(LIBS) $(CXXLIBS)
	$(STRIP) $@
swfc$(E): parser.$(O) swfc.$(O) ../lib/q.$(O) ../lib/mp3.$(O) ../lib/wav.$(O) ../lib/png.$(O) ../lib/librfxswf$(A)
	$(L) parser.$(O) swfc.$(O) ../lib/q.$(O) ../lib/mp3.$(O) ../lib/wav.$(O) ../lib/png.$(O) -o $@ ../lib/librfxswf$(A) $(LIBS)
	$(STRIP) $@

install:
	$(mkinstalldirs) $(bindir)
	$(mkinstalldirs) $(man1dir)
	@for file in $(programs); do $(INSTALL_BIN);$(INSTALL_MAN1);done
	
uninstall:
	@for file in $(programs); do $(UNINSTALL_BIN);$(UNINSTALL_MAN1);done

clean: 
	rm -f *.o *.obj *.lo *.la *~ gmon.out
	rm -f gif2swf swfbbox swfedit swfdump pdf2swf wav2swf png2swf swfcombine swfextract swfstrings png2swf jpeg2swf swfc font2swf
	@rm -f gif2swf.exe swfedit.exe pdf2swf.exe swfbbox.exe swfdump.exe wav2swf.exe png2swf.exe swfcombine.exe swfextract.exe swfstrings.exe png2swf.exe jpeg2swf.exe swfc.exe font2swf.exe
	@rm -f gif2swf$(E) pdf2swf$(E) swfedit$(E) swfbbox$(E) swfdump$(E) wav2swf$(E) png2swf$(E) swfcombine$(E) swfextract$(E) swfstrings$(E) png2swf$(E) jpeg2swf$(E) swfc$(E) font2swf$(E)

doc:
	perl ../parsedoc.pl wav2swf.doc
	perl ../parsedoc.pl png2swf.doc
	perl ../parsedoc.pl gif2swf.doc
	perl ../parsedoc.pl swfbbox.doc
	perl ../parsedoc.pl font2swf.doc
	perl ../parsedoc.pl jpeg2swf.doc
	perl ../parsedoc.pl swfcombine.doc
	perl ../parsedoc.pl swfdump.doc
	perl ../parsedoc.pl swfc.doc
	#perl ../parsedoc.pl swfedit.doc

.PHONY: clean doc 
