top_builddir = ..
srcdir = @srcdir@
top_srcdir = @top_srcdir@
include ../Makefile.common

programs = wav2swf @PNG2SWF@ swfcombine swfstrings swfextract swfdump swfc @JPEG2SWF@ swfbbox

all: $(programs)

wav2swf.o: wav2swf.c wav.h
	$(C) wav2swf.c -o $@
wav.o: wav.c wav.h
	$(C) wav.c -o $@
png2swf.o: png2swf.c
	$(C) png2swf.c -o $@
swfcombine.o: swfcombine.c
	$(C) swfcombine.c -o $@
swfdump.o: swfdump.c
	$(C) swfdump.c -o $@
swfextract.o: swfextract.c
	$(C) swfextract.c -o $@
swfstrings.o: swfstrings.c
	$(C) swfstrings.c -o $@
swfbbox.o: swfbbox.c
	$(C) swfbbox.c -o $@
jpeg2swf.o: jpeg2swf.c
	$(C) jpeg2swf.c -o $@
swfc.o: swfc.c parser.h ../lib/q.h
	$(C) swfc.c -o $@
parser.o: parser.yy.c parser.h ../lib/q.h
	$(C) parser.yy.c -o $@

# TODO: include the following rule only if lex is available
parser.yy.c: parser.lex
	lex -Bs -oparser.yy.c parser.lex

wav2swf: wav2swf.o wav.o
	$(L) wav2swf.o wav.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) wav2swf
png2swf: png2swf.o
	$(L) png2swf.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) png2swf
swfcombine: swfcombine.o
	$(L) swfcombine.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) swfcombine
swfdump: swfdump.o
	$(L) swfdump.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) swfdump
swfextract: swfextract.o
	$(L) swfextract.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) swfextract
swfstrings: swfstrings.o
	$(L) swfstrings.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) swfstrings
swfbbox: swfbbox.o
	$(L) swfbbox.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) swfbbox
jpeg2swf: jpeg2swf.o
	$(L) jpeg2swf.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) jpeg2swf
swfc: parser.o swfc.o ../lib/q.o wav.o
	$(L) parser.o swfc.o ../lib/q.o wav.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) swfc

install:
	$(mkinstalldirs) $(bindir)
	$(mkinstalldirs) $(man1dir)
	@for file in $(programs); do $(INSTALL_BIN);$(INSTALL_MAN1);done
	
uninstall:
	@for file in $(programs); do $(UNINSTALL_BIN);$(UNINSTALL_MAN1);done

clean: 
	rm -f *.o *.lo *.a *.la swfbbox swfdump wav2swf png2swf swfcombine swfextract swfstrings png2swf jpeg2swf *~

