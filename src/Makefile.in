top_builddir = ..
srcdir = @srcdir@
top_srcdir = @top_srcdir@
include ../Makefile.common

programs = wav2swf$(E) @PNG2SWF@ swfcombine$(E) swfstrings$(E) swfextract$(E) swfdump$(E) swfc$(E) @JPEG2SWF@ swfbbox$(E)

all: $(programs)

wav2swf.o: wav2swf.c wav.h
	$(C) wav2swf.c -o $@
wav.o: wav.c wav.h
	$(C) wav.c -o $@
png2swf.o: png2swf.c
	$(C) png2swf.c -o $@
swfcombine.o: swfcombine.c
	$(C) swfcombine.c -o $@
swfdump.o: swfdump.c
	$(C) swfdump.c -o $@
swfextract.o: swfextract.c
	$(C) swfextract.c -o $@
swfstrings.o: swfstrings.c
	$(C) swfstrings.c -o $@
swfbbox.o: swfbbox.c
	$(C) swfbbox.c -o $@
jpeg2swf.o: jpeg2swf.c
	$(C) jpeg2swf.c -o $@
swfc.o: swfc.c parser.h ../lib/q.h
	$(C) swfc.c -o $@
parser.o: parser.yy.c parser.h ../lib/q.h
	$(C) parser.yy.c -o $@

# TODO: include the following rule only if lex is available
parser.yy.c: parser.lex
	lex -Bs -oparser.yy.c parser.lex

wav2swf$(E): wav2swf.o wav.o ../lib/librfxswf.a
	$(L) wav2swf.o wav.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) $@
png2swf$(E): png2swf.o ../lib/librfxswf.a
	$(L) png2swf.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) $@
swfcombine$(E): swfcombine.o ../lib/librfxswf.a
	$(L) swfcombine.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) $@
swfdump$(E): swfdump.o ../lib/librfxswf.a
	$(L) swfdump.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) $@
swfextract$(E): swfextract.o ../lib/librfxswf.a
	$(L) swfextract.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) $@
swfstrings$(E): swfstrings.o ../lib/librfxswf.a
	$(L) swfstrings.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) $@
swfbbox$(E): swfbbox.o ../lib/librfxswf.a
	$(L) swfbbox.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) $@
jpeg2swf$(E): jpeg2swf.o ../lib/librfxswf.a
	$(L) jpeg2swf.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) $@
swfc$(E): parser.o swfc.o ../lib/q.o wav.o ../lib/librfxswf.a
	$(L) parser.o swfc.o ../lib/q.o wav.o -o $@ ../lib/librfxswf.a $(LIBS)
	$(STRIP) $@

install:
	$(mkinstalldirs) $(bindir)
	$(mkinstalldirs) $(man1dir)
	@for file in $(programs); do $(INSTALL_BIN);$(INSTALL_MAN1);done
	
uninstall:
	@for file in $(programs); do $(UNINSTALL_BIN);$(UNINSTALL_MAN1);done

clean: 
	rm -f *.o *.lo *.a *.la *~
	rm -f swfbbox swfdump wav2swf png2swf swfcombine swfextract swfstrings png2swf jpeg2swf
	@rm -f swfbbox.exe swfdump.exe wav2swf.exe png2swf.exe swfcombine.exe swfextract.exe swfstrings.exe png2swf.exe jpeg2swf.exe
	@rm -f swfbbox$(E) swfdump$(E) wav2swf$(E) png2swf$(E) swfcombine$(E) swfextract$(E) swfstrings$(E) png2swf$(E) jpeg2swf$(E)

