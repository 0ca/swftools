top_builddir = ..
srcdir = @srcdir@
top_srcdir = @top_srcdir@
include ../Makefile.common

all: simple_viewer.swf keyboard_viewer.swf PreLoaderTemplate.swf

programs = simple_viewer keyboard_viewer PreLoaderTemplate

simple_viewer.o: simple_viewer.c
	$(C) -I../lib simple_viewer.c -o $@
keyboard_viewer.o: keyboard_viewer.c
	$(C) -I../lib keyboard_viewer.c -o $@
PreLoaderTemplate.o: PreLoaderTemplate.c
	$(C) -I../lib PreLoaderTemplate.c -o $@

simple_viewer: simple_viewer.o
	$(L) simple_viewer.o -o $@ ../lib/librfxswf.a $(LIBS) 
keyboard_viewer: keyboard_viewer.o
	$(L) keyboard_viewer.o -o $@ ../lib/librfxswf.a $(LIBS) 
PreLoaderTemplate: PreLoaderTemplate.o
	$(L) PreLoaderTemplate.o -o $@ ../lib/librfxswf.a $(LIBS) 

simple_viewer.swf: $(programs)
	@echo Calling ./keybard_viewer to create keyboard_viewer.swf
	./simple_viewer

keyboard_viewer.swf: $(programs)
	@echo Calling ./simple_viewer to create simple_viewer.swf
	./keyboard_viewer

PreLoaderTemplate.swf: $(programs)
	@echo Calling ./PreLoaderTemplate to create PreLoaderTemplate.swf
	./PreLoaderTemplate

install:
	$(mkinstalldirs) $(pkgdatadir)
	$(mkinstalldirs) $(pkgdatadir)/swfs
	$(INSTALL_DATA) ./simple_viewer.swf $(pkgdatadir)/swfs/simple_viewer.swf
	$(INSTALL_DATA) ./keyboard_viewer.swf $(pkgdatadir)/swfs/keyboard_viewer.swf
	$(INSTALL_DATA) ./PreLoaderTemplate.swf $(pkgdatadir)/swfs/PreLoaderTemplate.swf
	$(INSTALL_DATA) ./tessel_loader.swf $(pkgdatadir)/swfs/tessel_loader.swf
	$(INSTALL_DATA) ./swft_loader.swf $(pkgdatadir)/swfs/swft_loader.swf
	test -f $(pkgdatadir)/swfs/default_viewer.swf || \
	    $(LN_S) $(pkgdatadir)/swfs/simple_viewer.swf $(pkgdatadir)/swfs/default_viewer.swf;
	test -f $(pkgdatadir)/swfs/default_loader.swf || \
	    $(LN_S) $(pkgdatadir)/swfs/tessel_loader.swf $(pkgdatadir)/swfs/default_loader.swf;
		
uninstall:
	$(UNINSTALL_DATA) $(pkgdatadir)/swfs/simple_viewer.swf
	$(UNINSTALL_DATA) $(pkgdatadir)/swfs/keyboard_viewer.swf
	$(UNINSTALL_DATA) $(pkgdatadir)/swfs/PreLoaderTemplate.swf
	$(UNINSTALL_DATA) $(pkgdatadir)/swfs/tessel_loader.swf
	$(UNINSTALL_DATA) $(pkgdatadir)/swfs/swft_loader.swf
	$(UNINSTALL_DATA) $(pkgdatadir)/swfs/default_viewer.swf
	$(UNINSTALL_DATA) $(pkgdatadir)/swfs/default_loader.swf

clean: 
	rm -f *.o *.lo *.a *.la gmon.out simple_viewer keyboard_viewer PreLoaderTemplate simple_viewer.swf keyboard_viewer.swf PreLoaderTemplate.swf

